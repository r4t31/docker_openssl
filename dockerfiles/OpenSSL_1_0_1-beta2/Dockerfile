
# This file is automatically generated with Dockerfile.j2 as a template. Do not
# edit by hand, since your changes will be lost!
FROM buildpack-deps AS builder

# Create a shallow clone of the OpenSSL repository in the work directory,
# containing only the code of the specified version/tag.
WORKDIR /openssl
RUN git clone --branch OpenSSL_1_0_1-beta2 --depth 1 https://github.com/openssl/openssl.git .

# Compile OpenSSL
RUN ./config -fPIC no-asm zlib
RUN make

# Install to a temporary directory. The install command has changed through
# time. In 0.9.7e, the `install_sw` command was added, which does not install
# the docs. Release 1.1.0-pre3 changed the argument INSTALL_PREFIX to DESTDIR.
RUN make install_sw DESTDIR=/tmp/package-dir

# Install the package to a new container, so we only have this OpenSSL version.
FROM debian
COPY --from=builder /tmp/package-dir /
RUN ldconfig

# Expose the default port
EXPOSE 4433

# Copy the example key to the container
# COPY example/server.key example/server.crt ./
COPY certs/key.pem certs/cert.pem certs/cacert.pem ./

# Start the server
CMD openssl s_server -key key.pem -cert cert.pem -accept 4433 -HTTP